const openTab=function(n,t,i,r){const e=document.getElementById(i),u=document.getElementById(i).querySelectorAll(r);for(const n of u)n.style.display="none";const f=document.getElementById(i).querySelectorAll(".tab-link");for(const n of f)n.className=n.className.replace(" tab-active","");document.getElementById(t).style.display="block";n.currentTarget.className+=" tab-active"},getJsonValue=function(n,t){return t.split(".").reduce(function(n,t){return n&&n[t]},n)},addCollapsibleEventListeners=function(){const n=document.getElementsByClassName("collapsible-parameters-btn");for(const n of n)n.addEventListener("click",function(){this.classList.toggle("collapsible-parameters-btn-active");const n=this.nextElementSibling;n.style.height=n.clientHeight?0:n.scrollHeight+"px"})},addFileButtonsEventListeners=function(){const n=document.getElementsByClassName("inputfile");for(const n of n){const t=n.nextElementSibling,r=t.innerHTML,i=t.previousElementSibling;n.addEventListener("change",function(n){let u="";u=n.target.value.split("\\").pop();u?(t.innerHTML=i.innerHTML=u,t.style.backgroundColor=i.style.backgroundColor="green"):t.innerHTML=r})}},selectFocusIn=function(n){n.style.textAlign="left"},selectFocusOut=function(n){n.style.textAlign="center"},recalculateCollapsibleContentHeight=function(n){const t=document.getElementById(n);t.style.height="auto"},hideConversionParameters=function(n){const t=document.getElementsByClassName(n);for(const n of t){n.style.display="none";const t=n.querySelectorAll("input");for(const n of t)n.disabled=!0}},displayParametersElements=function(n,t){const i=document.getElementById(n),r=document.getElementById(t);r.style.display="block";i.style.display="grid";const u=i.querySelectorAll("input");for(const n of u)n.disabled=!1},displayMetricParameters=function(){const n=document.getElementById("metric").value;switch(n){case"GaussKernel":hideConversionParameters("metric-parameters");displayParametersElements("gauss-parameters","metric-parameters-headline");break;default:hideConversionParameters("metric-parameters")}recalculateCollapsibleContentHeight("conversion-collapsible-content")},displayAlgorithmParameters=function(){const n=document.getElementById("convert").value;switch(n){case"EpsilonKNN":hideConversionParameters("algorithm-parameters");displayParametersElements("epsilon-parameters","algorithm-parameters-headline");break;default:hideConversionParameters("algorithm-parameters")}recalculateCollapsibleContentHeight("conversion-collapsible-content")};window.addEventListener("load",function(){addFileButtonsEventListeners();addCollapsibleEventListeners();displayMetricParameters();displayAlgorithmParameters()});const shortestPathsBFS=function(n,t){const i={},r={},{nodes:u,nodes:{length:f}}=n;for(const t of u){const u=t.id;i[u]={};r[u]={};for(const t of n.nodes){const n=t.id;i[u][n]=Infinity;r[u][n]=!1}}for(const[n,e]of u.entries()){const o=e.id;i[o][o]=0;r[o][o]=!0;const s=new Queue;for(s.enqueue(o);!s.isEmpty;){const e=s.dequeue();for(let h=n;h<f;h++){const n=u[h].id;r[o][n]===!1&&(t[e+","+n]||t[n+","+e]||e==n)&&(r[o][n]=!0,i[o][n]=i[n][o]=i[o][e]+1,s.enqueue(n))}}}return i}(function(n,t){typeof exports=="object"&&typeof module!="undefined"?t(exports,require("d3-dispatch"),require("d3-drag"),require("d3-interpolate"),require("d3-selection"),require("d3-transition")):typeof define=="function"&&define.amd?define(["exports","d3-dispatch","d3-drag","d3-interpolate","d3-selection","d3-transition"],t):t(n.d3=n.d3||{},n.d3,n.d3,n.d3,n.d3,n.d3)}(this,function(n,t,i,r,u,f){"use strict";function k(){u.event.stopImmediatePropagation()}function h(n){return{type:n}}function ft(){return!u.event.button}function et(){var n=this.ownerSVGElement||this;return[[0,0],[n.width.baseVal.value,n.height.baseVal.value]]}function y(n){while(!n.__brush)if(!(n=n.parentNode))return;return n.__brush}function p(n){return n[0][0]===n[1][0]||n[0][1]===n[1][1]}function ot(n){var t=n.__brush;return t?t.dim.output(t.selection):null}function st(){return w(l)}function ht(){return w(a)}function w(n){function w(t){var r=t.property("__brush",pt).selectAll(".overlay").data([h("overlay")]),i;r.enter().append("rect").attr("class","overlay").attr("pointer-events","all").attr("cursor",e.overlay).merge(r).each(function(){var n=y(this).extent;u.select(this).attr("x",n[0][0]).attr("y",n[0][1]).attr("width",n[1][0]-n[0][0]).attr("height",n[1][1]-n[0][1])});t.selectAll(".selection").data([h("selection")]).enter().append("rect").attr("class","selection").attr("cursor",e.selection).attr("fill","#777").attr("fill-opacity",.3).attr("stroke","#fff").attr("shape-rendering","crispEdges");i=t.selectAll(".handle").data(n.handles,function(n){return n.type});i.exit().remove();i.enter().append("rect").attr("class",function(n){return"handle handle--"+n.type}).attr("cursor",function(n){return e[n.type]});t.each(ot).attr("fill","none").attr("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush touchstart.brush",yt)}function ot(){var t=u.select(this),n=y(this).selection;n?(t.selectAll(".selection").style("display",null).attr("x",n[0][0]).attr("y",n[0][1]).attr("width",n[1][0]-n[0][0]).attr("height",n[1][1]-n[0][1]),t.selectAll(".handle").style("display",null).attr("x",function(t){return t.type[t.type.length-1]==="e"?n[1][0]-it/2:n[0][0]-it/2}).attr("y",function(t){return t.type[0]==="s"?n[1][1]-it/2:n[0][1]-it/2}).attr("width",function(t){return t.type==="n"||t.type==="s"?n[1][0]-n[0][0]+it:it}).attr("height",function(t){return t.type==="e"||t.type==="w"?n[1][1]-n[0][1]+it:it})):t.selectAll(".selection,.handle").style("display","none").attr("x",null).attr("y",null).attr("width",null).attr("height",null)}function ct(n,t){return n.__brush.emitter||new vt(n,t)}function vt(n,t){this.that=n;this.args=t;this.state=n.__brush;this.active=0}function yt(){function li(){var n=u.mouse(bt);oi=n;hi=!0;c();fi()}function fi(){var n;h=oi[0]-ri[0];w=oi[1]-ri[1];switch(wt){case v:case d:t&&(h=Math.max(dt-b,Math.min(ni-it,h)),st=b+h,vt=it+h);r&&(w=Math.max(gt-tt,Math.min(ti-ft,w)),lt=tt+w,yt=ft+w);break;case o:t<0?(h=Math.max(dt-b,Math.min(ni-b,h)),st=b+h,vt=it):t>0&&(h=Math.max(dt-it,Math.min(ni-it,h)),st=b,vt=it+h);r<0?(w=Math.max(gt-tt,Math.min(ti-tt,w)),lt=tt+w,yt=ft):r>0&&(w=Math.max(gt-ft,Math.min(ti-ft,w)),lt=tt,yt=ft+w);break;case s:t&&(st=Math.max(dt,Math.min(ni,b-h*t)),vt=Math.max(dt,Math.min(ni,it+h*t)));r&&(lt=Math.max(gt,Math.min(ti,tt-w*r)),yt=Math.max(gt,Math.min(ti,ft+w*r)))}vt<st&&(t*=-1,n=b,b=it,it=n,n=st,st=vt,vt=n,pt in g&&ii.attr("cursor",e[pt=g[pt]]));yt<lt&&(r*=-1,n=tt,tt=ft,ft=n,n=lt,lt=yt,yt=n,pt in nt&&ii.attr("cursor",e[pt=nt[pt]]));kt.selection&&(et=kt.selection);vi&&(st=et[0][0],vt=et[1][0]);yi&&(lt=et[0][1],yt=et[1][1]);(et[0][0]!==st||et[0][1]!==lt||et[1][0]!==vt||et[1][1]!==yt)&&(kt.selection=[[st,lt],[vt,yt]],ot.call(bt),si.brush())}function ai(){if(k(),u.event.touches){if(u.event.touches.length)return;ht&&clearTimeout(ht);ht=setTimeout(function(){ht=null},500);ui.on("touchmove.brush touchend.brush touchcancel.brush",null)}else{i.dragEnable(u.event.view,hi);ci.on("keydown.brush keyup.brush mousemove.brush mouseup.brush",null)}ui.attr("pointer-events","all");ii.attr("cursor",e.overlay);kt.selection&&(et=kt.selection);p(et)&&(kt.selection=null,ot.call(bt));si.end()}function pi(){switch(u.event.keyCode){case 18:wt===o&&(t&&(it=vt-h*t,b=st+h*t),r&&(ft=yt-w*r,tt=lt+w*r),wt=s,fi());break;case 32:(wt===o||wt===s)&&(t<0?it=vt-h:t>0&&(b=st-h),r<0?ft=yt-w:r>0&&(tt=lt-w),wt=v,ii.attr("cursor",e.selection),fi());break;default:return}c()}function wi(){switch(u.event.keyCode){case 18:wt===s&&(t<0?it=vt:t>0&&(b=st),r<0?ft=yt:r>0&&(tt=lt),wt=o,fi());break;case 32:wt===v&&(u.event.altKey?(t&&(it=vt-h*t,b=st+h*t),r&&(ft=yt-w*r,tt=lt+w*r),wt=s):(t<0?it=vt:t>0&&(b=st),r<0?ft=yt:r>0&&(tt=lt),wt=o),ii.attr("cursor",e[pt]),fi());break;default:return}c()}var ui,ii,ci;if(u.event.touches){if(u.event.changedTouches.length<u.event.touches.length)return c()}else if(ht)return;if(at.apply(this,arguments)){var bt=this,pt=u.event.target.__data__.type,wt=(u.event.metaKey?pt="overlay":pt)==="selection"?d:u.event.altKey?s:o,t=n===a?null:rt[pt],r=n===l?null:ut[pt],kt=y(bt),ei=kt.extent,et=kt.selection,dt=ei[0][0],b,st,gt=ei[0][1],tt,lt,ni=ei[1][0],it,vt,ti=ei[1][1],ft,yt,h,w,hi,vi,yi,ri=u.mouse(bt),oi=ri,si=ct(bt,arguments).beforestart();if(pt==="overlay"?kt.selection=et=[[b=n===a?dt:ri[0],tt=n===l?gt:ri[1]],[it=n===a?ni:b,ft=n===l?ti:tt]]:(b=et[0][0],tt=et[0][1],it=et[1][0],ft=et[1][1]),st=b,lt=tt,vt=it,yt=ft,ui=u.select(bt).attr("pointer-events","none"),ii=ui.selectAll(".overlay").attr("cursor",e[pt]),u.event.touches)ui.on("touchmove.brush",li,!0).on("touchend.brush touchcancel.brush",ai,!0);else ci=u.select(u.event.view).on("keydown.brush",pi,!0).on("keyup.brush",wi,!0).on("mousemove.brush",li,!0).on("mouseup.brush",ai,!0),i.dragDisable(u.event.view);k();f.interrupt(bt);ot.call(bt);si.start()}}function pt(){var t=this.__brush||{selection:null};return t.extent=lt.apply(this,arguments),t.dim=n,t}var lt=et,at=ft,st=t.dispatch(w,"start","brush","end"),it=6,ht;return w.move=function(t,i){t.selection?t.on("start.brush",function(){ct(this,arguments).beforestart().start()}).on("interrupt.brush end.brush",function(){ct(this,arguments).end()}).tween("brush",function(){function o(n){u.selection=n===1&&p(f)?null:h(n);ot.call(t);s.brush()}var t=this,u=t.__brush,s=ct(t,arguments),e=u.selection,f=n.input(typeof i=="function"?i.apply(this,arguments):i,u.extent),h=r.interpolate(e,f);return e&&f?o:o(1)}):t.each(function(){var t=this,u=arguments,e=t.__brush,r=n.input(typeof i=="function"?i.apply(t,u):i,e.extent),o=ct(t,u).beforestart();f.interrupt(t);e.selection=r==null||p(r)?null:r;ot.call(t);o.start().brush().end()})},vt.prototype={beforestart:function(){return++this.active==1&&(this.state.emitter=this,this.starting=!0),this},start:function(){return this.starting&&(this.starting=!1,this.emit("start")),this},brush:function(){return this.emit("brush"),this},end:function(){return--this.active==0&&(delete this.state.emitter,this.emit("end")),this},emit:function(t){u.customEvent(new tt(w,t,n.output(this.state.selection)),st.apply,st,[t,this.that,this.args])}},w.extent=function(n){return arguments.length?(lt=typeof n=="function"?n:b([[+n[0][0],+n[0][1]],[+n[1][0],+n[1][1]]]),w):lt},w.filter=function(n){return arguments.length?(at=typeof n=="function"?n:b(!!n),w):at},w.handleSize=function(n){return arguments.length?(it=+n,w):it},w.on=function(){var n=st.on.apply(st,arguments);return n===st?w:n},w}var b=function(n){return function(){return n}},tt=function(n,t,i){this.target=n;this.type=t;this.selection=i},c=function(){u.event.preventDefault();u.event.stopImmediatePropagation()},d={name:"drag"},v={name:"space"},o={name:"handle"},s={name:"center"},l={name:"x",handles:["e","w"].map(h),input:function(n,t){return n&&[[n[0],t[0][1]],[n[1],t[1][1]]]},output:function(n){return n&&[n[0][0],n[1][0]]}},a={name:"y",handles:["n","s"].map(h),input:function(n,t){return n&&[[t[0][0],n[0]],[t[1][0],n[1]]]},output:function(n){return n&&[n[0][1],n[1][1]]}},it={name:"xy",handles:["n","e","s","w","nw","ne","se","sw"].map(h),input:function(n){return n},output:function(n){return n}},e={overlay:"crosshair",selection:"move",n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},g={e:"w",w:"e",nw:"ne",ne:"nw",se:"sw",sw:"se"},nt={n:"s",s:"n",nw:"sw",ne:"se",se:"ne",sw:"nw"},rt={overlay:1,selection:1,n:null,e:1,s:null,w:-1,nw:-1,ne:1,se:1,sw:-1},ut={overlay:1,selection:1,n:-1,e:null,s:1,w:null,nw:-1,ne:-1,se:1,sw:1},ct=function(){return w(it)};n.brush=ct;n.brushX=st;n.brushY=ht;n.brushSelection=ot;Object.defineProperty(n,"__esModule",{value:!0})})),saveGraph=function(n){var t=document.createElement("a"),i;const r=serializeGraph();i=new Blob([JSON.stringify(r,null,2)],{type:"application/json"});t.href=URL.createObjectURL(i);t.download=n;t.click()},serializeGraph=function(){const n={};n.store=store;const r=structuredClone(graph),{links:t}=r;for(let n=0;n<t.length;n++)t[n].source=t[n].source.id,t[n].target=t[n].target.id;n.graph=r;const u=structuredClone(selectionGraph),{links:i}=u;for(let n=0;n<i.length;n++)i[n].source=i[n].source.id,i[n].target=i[n].target.id;n.selectionGraph=u;n.forceProperties=forceProperties;const f=serializeFilters();return n.filters=f,n},serializeNumericFilters=function(n){const i=n.getElementsByClassName("numeric"),t=[];for(const n of i){const i=n.querySelector("h4").innerHTML,r=n.querySelector("#"+i+"-sliderOutputMin"),u=n.querySelector("#"+i+"-sliderOutputMax"),f={attribute:i,min:parseFloat(r.min),max:parseFloat(u.max),lowValue:parseFloat(r.value),highValue:parseFloat(u.value)};t.push(f)}return parseFloat(),t},serializeCategoricalFilters=function(n){const i=n.getElementsByClassName("categorical"),t=[];for(const n of i){const r=n.querySelector("h4").innerHTML,u=n.querySelectorAll("input"),i={attribute:r,categories:{}};for(const n of u){const t=n.value,r=n.checked;i.categories[t]=r}t.push(i)}return t},serializeFilters=function(){const n=document.getElementById("attributes");return{numeric:serializeNumericFilters(n),categorical:serializeCategoricalFilters(n)}},loadNetwork=async function(n){var t=new FileReader;t.onload=function(n){deleteGraphElementsAndControls();updateSelectionNodesAndLinks();var t=JSON.parse(n.target.result);forceProperties=t.forceProperties;filters=t.filters;graph=t.graph;selectionGraph=t.selectionGraph;drawSelectionNetwork(selectionGraph);selectionGraph.nodes.forEach(function(n){addSelectionDiv(n)});generateGraphControlAndElements(graph,forceProperties,filters);gDraw.html("");drawNetwork(graph);updateForces(!1);ticked();forceProperties.attributeColouring.enabled||updateNodeAndLinkColour(node,link);updateHeadingColour(graph.nodes);store=t.store};t.readAsText(n)},toggleNetworkInput=function(){$("#mvn-input-section").toggleClass("active-block");hideAllInputForms()},hideAllInputForms=function(){$("#mvn-input-section form.active-flex").removeClass("active-flex")},openNetworkInputForm=function(n){toggleNetworkInput();$("#"+n).addClass("active-flex")},addCollapsibleEventListeners=function(){const n=document.getElementsByClassName("collapsible-parameters-btn");for(const n of n)n.addEventListener("click",function(){this.classList.toggle("collapsible-parameters-btn-active");const n=this.nextElementSibling;n.style.height=n.clientHeight?0:n.scrollHeight+"px"})},addFileButtonsEventListeners=function(){const n=document.getElementsByClassName("inputfile");for(const n of n){const t=n.nextElementSibling,r=t.innerHTML,i=t.previousElementSibling;n.addEventListener("change",function(n){let u="";u=n.target.value.split("\\").pop();u?(t.innerHTML=i.innerHTML=u,t.style.backgroundColor=i.style.backgroundColor="green"):t.innerHTML=r})}},selectFocusIn=function(n){n.style.textAlign="left"},selectFocusOut=function(n){n.style.textAlign="center"},recalculateCollapsibleContentHeight=function(n){const t=document.getElementById(n);t.style.height="auto"},hideConversionParameters=function(n,t){const i=n.querySelectorAll("."+t);for(const n of i){n.style.display="none";const t=n.querySelectorAll("input");for(const n of t)n.disabled=!0}},displayParametersElements=function(n,t){const i=n.querySelector("#"+t);i.style.display="grid";const r=i.querySelectorAll("input");for(const n of r)n.disabled=!1},displayMetricParameters=function(n){const i=document.getElementById(n),r=i.value,t=i.nextElementSibling;switch(r){case"GaussKernel":hideConversionParameters(t,"metric-parameters");displayParametersElements(t,"gauss-parameters");break;default:hideConversionParameters(t,"metric-parameters")}},displayAlgorithmParameters=function(n){const i=document.getElementById(n),r=i.value,t=i.nextElementSibling;switch(r){case"EpsilonKNN":hideConversionParameters(t,"algorithm-parameters");displayParametersElements(t,"epsilon-parameters");break;default:hideConversionParameters(t,"algorithm-parameters")}},prepareInputForm=function(){addFileButtonsEventListeners();addCollapsibleEventListeners();displayMetricParameters("metric");displayAlgorithmParameters("convert");displayMetricParameters("append-metric");displayAlgorithmParameters("append-convert");const n=document.getElementById("mvn-input-section");n.addEventListener("click",toggleNetworkInput);for(const n of n.querySelectorAll("form"))n.addEventListener("click",function(n){n.stopPropagation()});$("#mvn-append-form").submit(function(n){const t=n.currentTarget.querySelector("#currentGraph");t.value=JSON.stringify(store)})},isNullOrEmpty=function(n){return n===null||n===""},validateNewNetworkForm=function(n){let t=!0,i="";const r=n.querySelector("#fileVector").value;isNullOrEmpty(r)&&(i+="Please insert the vector file.<br>",t=!1);const u=n.querySelector("#separators").value;isNullOrEmpty(u)&&(i+="Please enter the data separating character.<br>",t=!1);const f=n.querySelector("#missingvalues").value;isNullOrEmpty(f)&&(i+="Please enter the string which will represents missing values.<br>",t=!1);const e=n.querySelector("#new-network-error-para");return e.innerHTML=i,t},validateAppendNetworkForm=function(n){let t=!0,i="";graph.nodes.length<=0&&(i+="There is no graph to append to.<br>",t=!1);const r=n.querySelector("#fileVectorAppend").value;isNullOrEmpty(r)&&(i+="Please insert the vector file.<br>",t=!1);const u=n.querySelector("#separatorsAppend").value;isNullOrEmpty(u)&&(i+="Please enter the data separating character.<br>",t=!1);const f=n.querySelector("#missingvaluesAppend").value;isNullOrEmpty(f)&&(i+="Please enter the string which will represents missing values.<br>",t=!1);const e=n.querySelector("#append-network-error-para");return e.innerHTML=i,t},nodeHeadingClick=function(n,t,i){selectNode(n,t);toggleNodeDetails(t,i)},nodeHeadingMouseOver=function(n,t){fadeDisconnectedNodes(n,t)},selectNode=function(n,t){n.shiftKey||deselectAllNodes();const i=document.getElementById("heading-"+t);i.classList.add("node-heading-selected");nodeGroups.classed("selected",function(n){return n.selected=n.selected|n.id==t})},toggleNodeDetails=function(n,t){const u=document.getElementById("node-detail-heading"),i=document.getElementById("node-detail-container"),f=document.getElementById("node-attributes"),e=document.getElementById("node-centralities");i.setAttribute("data-id",n);u.innerHTML="Node: "+n;(i.style.display==="none"||i.style.display==="")&&(i.style.display="block");let r=f.getElementsByTagName("input");for(const n of r){const i=n.getAttribute("data-attribute");n.value=graph.nodes[t][i]}r=e.getElementsByTagName("input");for(const t of r){const r=t.getAttribute("data-attribute"),{[attributeName]:i}=graph.properties;t.value=i!==undefined?i.values[n]:"Calculating"}},closeNodeDetails=function(n){const t=document.getElementById(n);t.style.display="none"};class Queue{constructor(){this.data={};this.head=0;this.tail=0}enqueue(n){this.data[this.tail]=n;this.tail++}dequeue(){const n=this.data[this.head];return delete this.data[this.head],this.head++,n}peek(){return this.data[this.head]}get length(){return this.tail-this.head}get isEmpty(){return this.length===0}}const inputColorClick=function(n){n.querySelector("input").click()},stopClickPropagation=function(n){n.stopPropagation()},selectNodesBySelection=function(n){deselectAllNodes();nodeGroups.filter(function(t){return graph.partitions[t.id]===n}).classed("selected",function(n){return n.previouslySelected=n.selected,n.selected=!0})},changeGroupColour=function(n,t){const u=n.parentNode,i=n.value,r=node.filter(function(n){return graph.partitions[n.id]===t});r.style("fill",function(n){const t=document.getElementById("heading-"+n.id),r=fontLightness(i);return t.style.color="hsl(0, 0%, "+String(r)+"%)",t.style.backgroundColor=i,link.filter(function(t){return t.source===n.id||t.source.id===n.id}).style("stroke",i),i})},setGroupColour=function(n){document.getElementById("selection_color_"+n.id).value=groupColours(n.id)},getGroupColour=function(n){return document.getElementById("selection_color_"+n.id).value},addNewSelection=function(){const{length:i,[length-1]:r}=selectionGraph.nodes,n=i===0?0:r.id+1,t={};t.id=n;t.name="Selection "+n;t.nonodes=0;selectionGraph.nodes.push(t);for(const t of selectionGraph.nodes){const i={};i.source=n;i.target=t.id;i.value=0;const r={};r.source=t.id;r.target=n;r.value=0;selectionGraph.links.push(i);n!=t.id&&selectionGraph.links.push(r)}addSelectionDiv(t);updateSelectionNodesAndLinks()},addSelectionDiv=function(n){const t=n.id.toString(),r=d3.select("#list-selections"),i=r.append("div").classed("selection-panel",!0).attr("id","selection_panel_"+t).attr("onclick","selectNodesBySelection('"+t+"')");i.append("h4").attr("class","panel-title").attr("contenteditable","true").attr("onclick","stopClickPropagation(event)").html("Selection "+t);const u=i.append("input").attr("type","color").attr("id","selection_color_"+t).attr("value",groupColours(t)).attr("onchange","changeGroupColour(this,"+t+")");i.style("background-color",u.attr("value"));const f=i.append("button").attr("class","btn btn-danger btn-sm rounded-0").attr("type","button").attr("data-toggle","tooltip").attr("data-placement","top").attr("title","Add Selected Nodes To This Group").attr("onclick","addNodesToSelection(event,"+t+")");f.append("i").attr("class","fa fa-plus-square");const e=i.append("button").attr("class","btn btn-danger btn-sm rounded-0").attr("type","button").attr("data-toggle","tooltip").attr("data-placement","top").attr("title","Delete").attr("onclick","deleteSelection(event,"+t+")");e.append("i").attr("class","fa fa-trash")},hexToRgb=function(n){n=n.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(n,t,i,r){return t+t+i+i+r+r});const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null},fontLightness=function(n){let t=n;typeof n!="object"&&(t=hexToRgb(n));const{r:i,g:r,b:u}=t,f=i*.2126,e=r*.7152,o=u*.0722,s=f+e+o,h=s/255;return(h-.5)*-1e7},addNodesToSelection=function(n,t){n.stopPropagation();const i=document.getElementById("selection_color_"+t).value,r=fontLightness(i);node.filter(function(n){return n.selected}).each(function(n){let r=null;const{id:i}=n,{[nodeId]:u}=graph.partitions;if(u!=""){r=u;link.filter(function(n){return n.source.id==i||n.target.id==i}).each(function(n){const{source:{id:o},target:{id:s},value:u}=n,{[sourceId]:f,[targetId]:e}=graph.partitions;if(f!=""&&e!="")if(o==i&&e!=""){const i=selectionGraph.links.find(n=>n.source.id==t&&n.target.id==e),n=selectionGraph.links.find(n=>n.source.id==r&&n.target.id==e);n.value=n.value-u;i.value=n.value+u}else if(s==i&&f!=""){const n=selectionGraph.links.find(n=>n.source.id==f&&n.target.id==r),i=selectionGraph.links.find(n=>n.source.id==f&&n.target.id==t);n.value=n.value-u;i.value=n.value+u}});const n=selectionGraph.nodes.find(n=>n.id==r);n.nonodes=n.nonodes-1}else link.filter(function(n){return n.source.id==i||n.target.id==i}).each(function(n){var r;const{source:{id:o},target:{id:s},value:u}=n,{[sourceId]:f,[targetId]:e}=graph.partitions;o==i&&e!=""?(r=selectionGraph.links.find(n=>n.source.id==t&&n.target.id==e),r.value=r.value+u):s==i&&f!=""&&(r=selectionGraph.links.find(n=>n.source.id==f&&n.target.id==t),r.value=r.value+u)});const f=selectionGraph.nodes.find(n=>n.id==t);f.nonodes=f.nonodes+1;graph.partitions[n.id]=t}).style("fill",function(n){const t=document.getElementById("heading-"+n.id);return t.style.backgroundColor=i,t.style.color="hsl(0, 0%, "+String(r)+"%)",i});selectionNode.select("title").text(function(n){return"Number of Nodes: "+n.nonodes});selectionLink.select("title").text(function(n){return n.value})},deleteAllSelections=function(){const{partitions:n}=graph;for(const t in n)n[t]="";const{network:t}=forceProperties.colouring,i=fontLightness(t);d3.selectAll(".node-heading").style("background-color",t).style("color","hsl(0, 0%, "+String(i)+"%)");selectionGraph.nodes=[];selectionGraph.links=[];updateSelectionNodesAndLinks();const r=document.getElementById("list-selections");r.innerHTML=""},deleteSelection=function(n,t){n.stopPropagation();const i=document.getElementById("selection_panel_"+t);i.parentNode.removeChild(i);const r=fontLightness(forceProperties.colouring.network),u=node.filter(function(n){return graph.partitions[n.id]==t});forceProperties.attributeColouring.enabled?u.each(function(n){return d3.select("#heading-"+n.id).style("background-color",forceProperties.colouring.network).style("color","hsl(0, 0%, "+String(r)+"%)"),graph.partitions[n.id]="",forceProperties.colouring.network}):u.style("fill",function(n){return link.filter(function(t){return t.source.id===n.id}).style("stroke",forceProperties.colouring.network),d3.select("#heading-"+n.id).style("background-color",forceProperties.colouring.network).style("color","hsl(0, 0%, "+String(r)+"%)"),graph.partitions[n.id]="",forceProperties.colouring.network});selectionGraph.nodes=selectionGraph.nodes.filter(function(n){return n.id!=t});selectionGraph.links=selectionGraph.links.filter(function(n){return n.source.id!=t&&n.target.id!=t});updateSelectionNodesAndLinks()},stringifyCommunityDetectionLinkReplacer=function(n,t){switch(n){case"source":case"target":return t.id;default:return t}},requestCommunityDetection=function(){store.nodes.forEach(function(n){graph.partitions[n.id]=""});const n=JSON.stringify(graph.nodes,["id"]),t=JSON.stringify(graph.links,stringifyCommunityDetectionLinkReplacer);$.ajax({url:"/Home/GraphCommunityDetection",type:"POST",data:{graphNodes:n,graphLinks:t},success:function(n){if(deleteAllSelections(),graph.partitions=JSON.parse(n.newPartitions),store.partitions=graph.partitions,selectionGraph=JSON.parse(n.newSelections),selectionGraph.nodes.forEach(function(n){addSelectionDiv(n)}),updateSelectionNodesAndLinks(),!forceProperties.attributeColouring.enabled){updateNodeAndLinkColour(node,link);return}updateHeadingColour(node)},error:function(n,t,i){alert(i)}})},closeAllToolbarPanels=function(){$(".toolbar-panel.active-flex").removeClass("active-flex")},toggleToolPanel=function(n,t){n.stopPropagation();closeAllToolbarPanels();closeAllRemodelPanels();$("#"+t).toggleClass("active-flex")},openFileBrowser=function(n){document.getElementById(n).click()},isLower=function(n,t){return n<t},isGreater=function(n,t){return n>t};class FilterCondition{constructor(n){this.booleanFunction=n}}const lower=new FilterCondition(isLower),greater=new FilterCondition(isGreater),filterByValue=function(n,t,i,r){let u=n.value;const e=r?n.max:n.min,f=r?"_max":"_min",h=r?"high":"low";i.booleanFunction(u,e)&&(u=e,n.value=e);attributefilter[t]||(attributefilter[t]={});attributefilter[t][h]=u;const{nodes:c,links:l}=store,{nodes:o,links:s}=graph;c.forEach(function(n){const{[filteredAttributeName]:r}=n,e=$("#heading-"+n.id);if(r!=="")if(i.booleanFunction(r,u)){if(!n.filters){n.filters=[];for(const[t,i]of o.entries())n.id===i.id&&o.splice(t,1);filterNodeList.push(n.id);e.addClass("node-heading-disabled")}n.filters.includes(t+f)||n.filters.push(t+f)}else!i.booleanFunction(r,u)&&n.filters&&n.filters.length>0&&n.filters.includes(t+f)&&(n.filters.splice(n.filters.indexOf(t+f),1),n.filters.length===0&&(o.push($.extend(!0,{},n)),filterNodeList.splice(filterNodeList.indexOf(n.id),1),delete n.filters,e.removeClass("node-heading-disabled")))});l.forEach(function(n){const{source:t,target:i}=n;if(filterNodeList.includes(t)||filterNodeList.includes(i)||!n.filtered){if((filterNodeList.includes(t)||filterNodeList.includes(i))&&!n.filtered){n.filtered=!0;for(const[t,i]of s.entries())n.id===i.id&&s.splice(t,1)}}else n.filtered=!1,s.push($.extend(!0,{},n))});updateNodesAndLinks();resetSimulation()},filterByCategory=function(n,t,i){const{nodes:f,links:e}=store,{nodes:r,links:u}=graph;f.forEach(function(u){const{[filteredAttributeName]:f}=u;f!==""&&(i||f!==t?i&&f===t&&u.filters&&(delete attributefilter[n],u.filters.length>0&&u.filters.includes(n+"_"+t)&&(u.filters.splice(u.filters.indexOf(n+"_"+t),1),u.filters.length===0&&(r.push($.extend(!0,{},u)),filterNodeList.splice(filterNodeList.indexOf(u.id),1),delete u.filters))):(attributefilter[n]||(attributefilter[n]={}),attributefilter[n].cat=t,u.filters||(u.filters=[],r.forEach(function(n,t){u.id===n.id&&r.splice(t,1)}),filterNodeList.push(u.id)),u.filters.includes(n+"_"+t)||u.filters.push(n+"_"+t)))});e.forEach(function(n){const{source:t,target:i}=n;filterNodeList.includes(t)||filterNodeList.includes(i)||!n.filtered?(filterNodeList.includes(t)||filterNodeList.includes(i))&&!n.filtered&&(n.filtered=!0,u.forEach(function(t,i){n.id===t.id&&graph.links.splice(i,1)})):(n.filtered=!1,u.push($.extend(!0,{},n)))});updateNodesAndLinks();resetSimulation()},handleForceEnablement=function(n,t,i){forceProperties[t].enabled=n;i();resetSimulation()},handleForceChange=function(n,t,i,r,u){d3.select("#"+t).text(n);forceProperties[i][r]=Number(n);u();resetSimulation()},getNodeAttribute=function(n,t){return n[t]},getNodeProperty=function(n,t){return graph.properties[t].values[n.id]},enableNodeLabels=function(){nodeText.classed("invisible",!forceProperties.labels.enabled)},setNodeLabel=function(n){const t=n.value,i=n.options[n.selectedIndex].closest("optgroup");forceProperties.labels.attribute=t;t===""&&nodeText.style("display","none");nodeText.style("display","block");let r=getNodeAttribute;if(i!==null){const n=i.getAttribute("label");n==="Centralities"&&(r=getNodeProperty)}nodeText.text(function(n){return r(n,t)})},setAttributeNodeSizing=function(n){const t=n.value,{radius:i}=forceProperties.collide;if(forceProperties.sizing.attribute=t,t!==""){forceProperties.sizing.enabled=!0;const e=n.options[n.selectedIndex].closest("optgroup").getAttribute("label");let u=null,r=null,f=null;e==="Attributes"?(u=parseFloat($("#"+t+"-sliderOutputMin").attr("max")),r=parseFloat($("#"+t+"-sliderOutputMin").attr("min")),f=getNodeAttribute):e==="Centralities"&&(u=graph.properties[t].max,r=graph.properties[t].min,f=getNodeProperty);node.attr("r",function(n){const e=f(n,t);if(e=="")return n.r=i/2;const o=i*2*((parseFloat(e)-r)/(u-r))+1;return n.r=o});setNodeFontSize();return}forceProperties.sizing.enabled=!1;node.attr("r",function(n){return n.r=i});setNodeFontSize()},rgbObjectToString=function(n){return"rgb("+n.r+", "+n.g+", "+n.b+")"},pickHex=function(n,t,i){const r=i,u=1-r;return{r:Math.round(n.r*u+t.r*r),g:Math.round(n.g*u+t.g*r),b:Math.round(n.b*u+t.b*r)}},setAttributeNodeColouring=function(n){const{lowValue:i,highValue:r}=forceProperties.attributeColouring,u=hexToRgb(i),f=hexToRgb(r),t=n.value;if(forceProperties.attributeColouring.attribute=t,t!==""){forceProperties.attributeColouring.enabled=!0;const o=n.options[n.selectedIndex].closest("optgroup").getAttribute("label");let r=null,i=null,e=null;o==="Numerical Attributes"?(r=parseFloat($("#"+t+"-sliderOutputMin").attr("max")),i=parseFloat($("#"+t+"-sliderOutputMin").attr("min")),e=getNodeAttribute):o==="Centralities"&&(r=graph.properties[t].max,i=graph.properties[t].min,e=getNodeProperty);node.style("fill",function(n){const o=e(n,t);if(o==="")return forceProperties.colouring.network;const h=(parseFloat(o)-i)/(r-i),s=pickHex(u,f,h),c=fontLightness(s),l=$("#"+n.id+"_node_text");return l.css("fill","hsl(0, 0%, "+String(c)+"%)"),rgbObjectToString(s)});link.style("stroke","white");return}forceProperties.attributeColouring.enabled=!1;updateNodeAndLinkColour(node,link)},projectAttributeXAxis=function(n){const t=n.value,{strength:r,enabled:u,x:f}=forceProperties.forceX,i="forceX";if(simulation.force(i).strength(r*u),t!==""){forceProperties.forceX.enabled=!0;forceProperties.forceX.attribute=t;const e=n.options[n.selectedIndex].closest("optgroup").getAttribute("label");let u=null,r=null,f=null;e==="Attributes"?(u=parseFloat($("#"+t+"-sliderOutputMin").attr("max")),r=parseFloat($("#"+t+"-sliderOutputMin").attr("min")),f=getNodeAttribute):e==="Centralities"&&(u=graph.properties[t].max,r=graph.properties[t].min,f=getNodeProperty);simulation.force(i).x(function(n){const i=f(n,t);if(i=="")return width/2;return width*((parseFloat(i)-r)/(u-r))});updateForces();return}forceProperties.forceX.enabled=!1;simulation.force(i).x(width*f);updateForces()},projectAttributeYAxis=function(n){const t=n.value,{strength:r,enabled:u,y:f}=forceProperties.forceY,i="forceY",e=function(n,t){return n[t]},o=function(n,t){return graph.properties[t].values[n.id]};if(simulation.force(i).strength(r*u),t!==""){forceProperties.forceY.enabled=!0;forceProperties.forceY.attribute=t;const s=n.options[n.selectedIndex].closest("optgroup").getAttribute("label");let u=null,r=null,f=null;s==="Attributes"?(u=parseFloat($("#"+t+"-sliderOutputMin").attr("max")),r=parseFloat($("#"+t+"-sliderOutputMin").attr("min")),f=e):s==="Centralities"&&(u=graph.properties[t].max,r=graph.properties[t].min,f=o);simulation.force(i).y(function(n){const i=f(n,t);if(i=="")return height/2;return height-height*((parseFloat(i)-r)/(u-r))});updateForces();return}forceProperties.forceY.enabled=!1;simulation.force(i).y(height*f);updateForces()},createDoubleSlider=function(n,t,i,r,u,f=r,e=u){$("#"+n).slider({range:!0,min:r,max:u,values:[f,e],step:.01,slide:function(n,r){$("#"+t).val(r.values[0]);$("#"+i).val(r.values[1]);r.handleIndex===0?filterByValue(r,t.split("-")[0],FilterCondition.lower,!1):r.handleIndex===1&&filterByValue(r,i.split("-")[0],FilterCondition.greater,!0)}})},closeAllRemodelPanels=function(){$(".remodel-attribute-panel.active-flex").removeClass("active-flex")},expandRemodelPanel=function(n,t){n.stopPropagation();closeAllToolbarPanels();closeAllRemodelPanels();$("#"+t).toggleClass("active-flex")},fillAttributeTransform=function(n,t){const i=[],r="input[type='checkbox'][data-role='"+t+"']:checked",u=$(n).find(r);for(const n of u)i.push(n.value);return i},remodelNetwork=function(n,t,i){const r=document.getElementById(n),e=document.getElementById(t).value,o=document.getElementById(i).value,s=$(r).find("input[type='checkbox'][data-role='remodeling']:not(:checked)"),h=$.makeArray(s.map((n,t)=>t.value)),u={normalize:[],standardize:[],distribution:[]};u.normalize=fillAttributeTransform(r,"normalization");u.standardize=fillAttributeTransform(r,"standardization");u.distribution=fillAttributeTransform(r,"distribution");const f={metric:{name:o,params:[]},algorithm:{name:e,params:[]}};switch(o){case"GaussKernel":const n=f.metric.params,t=parseFloat(document.getElementById("sigma").value);n.push(t)}switch(e){case"EpsilonKNN":const t=parseFloat(document.getElementById("epsilonRadius").value),i=parseInt(document.getElementById("kNNmin").value),n=f.algorithm.params;n.push(t);n.push(i)}const c=JSON.stringify(graph.nodes),l=JSON.stringify(graph.attributes),a=JSON.stringify(h),v=JSON.stringify(u),y=JSON.stringify(f);$.ajax({url:"/Home/RemodelNetwork",type:"POST",data:{nodes:c,attributes:l,excludedAttributes:a,attributeTransform:v,networkRemodelParams:y},success:function(n){const t=JSON.parse(n.newNetwork);graph.links=t;store.links=$.extend(!0,{},t);linkedByIndex={};for(let n of graph.links){const t=n.source+","+n.target;linkedByIndex[t]=1}updateLinks();requestCommunityDetection();updateLinkColour(link);calculateAllMetrics();resetSimulation()},error:function(n,t,i){alert(i)}})},changeNetworkNodeColour=function(n){forceProperties.colouring.network=n;updateNodeAndLinkColour(node,link)},changeNetworkBackgroundColour=function(n){forceProperties.colouring.background=n;$("#network-background-rect.background").css("fill",n)};